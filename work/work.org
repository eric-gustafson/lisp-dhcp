#+title: work


* TODO dhcp network based ip allocation code
** hashtable 
   ip => obj
*** List all ips in a net

#+BEGIN_SRC lisp :results value
  (let ((net (make-instance 'cidr-net
                            :cidr 24
                            :ipnum (nums-and-txt:octets->num #(172 18 200 0))
                            :mask (nums-and-txt:octets->num #(255 255 255 0)))))
    (list
     (total-ips net)
     (nums-and-txt:num->octets (first-ip net))
     (nums-and-txt:num->octets (last-ip net))))
       

       
#+END_SRC

#+RESULTS:
| 254 | (172 18 200 1) | (172 18 200 254) |

*** get-next ip
    Check the allocated list 



* TODO hard code network

* TODO I'm giving out the router address as the ip address

* TODO have everything come up from a boot

* TODO get routing working

* TODO 

* TODO Have the program install everything to run as a daemon
  

* TODO create a commissioning network
  This is a virtual interface with a network allocated from *network-malloc*


** TODO verfify that this shows up on RBPI

** TODO up/down this network
   (defmethod net-up ((obj netobj))
    )

   
** TODO allocate IP and network info



** TODO simple/dumb dhcp address allocation
   incf for now


* TODO Receive and decode dhcp broadcast
  To send and receive broadcast

** netmask
   Be sure that netmask is correct. in windows mask for broadcast
    packets does not matters, but not in linux.

** wildcard address
   bind socket to INADDR_ANY

** setsockopt
   setsockopt to BROADCAST

** sendto
   call sendto with sendaddr.sin_addr.s_addr = inet_addr("your_interface_broadcast_address")

   call sento several times for each interface with its broadcast ip address.

** call recvfrom. any time before calling recvfrom, set up length parameter




* TODO move netsecurity.org document for erlang dhcp project here
  It was all there, except for the actual way to stop x-talk on the wireless lan (seperate networks for each node)



* TODO Add a section to construct a reply
  Use the *commissioning-network* info above

* TODO change the print-object to display mac address
  mac address should use the 'size' operator which is one of the first parameters
  which then allows us to trim the chaddr field.

